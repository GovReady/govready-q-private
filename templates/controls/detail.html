{% extends "base.html" %}
{% load humanize %}
{% load guardian_tags %}
{% load static %}
{% load q %}

{% block title %}
{{ portfolio.title }} Control
{% endblock %}

{% block head %}
{% include "controls/_style-controls.html" %}
<style>

  #above-tab-content, #tab-content {
    max-width: 950px;
    margin: auto;
  }

  a { color: #666; }

  .control-text-modal {
      white-space: pre-wrap;
      font-size: 11pt;
      font-family: sans-serif;
      /* text-align: justify; */
      /* text-justify: inter-word; */
      /* line-height: 18px; */
  }

  .modal-content {
      position: fixed;
      margin: auto;
      width: 130%;
      /* height: calc(100% - 53px); */
      -webkit-transform: translate3d(0%, 0, 0);
          -ms-transform: translate3d(0%, 0, 0);
          -o-transform: translate3d(0%, 0, 0);
              transform: translate3d(0%, 0, 0);
  }
</style>

{% endblock %}

Remove contextbar from top of page
{% block contextbar %}{% endblock %}

% block body-wide %
{% block body %}

<div style="margin-top: 30px">
  <div class="container">

    <div class="row" style="">
      <div id="above-tab-content" class="row">
        <!-- Page Title-->
        <div style="float: left;">
          {% if control.title is not None %}
          <h2 id="control-heading" class="">
            {{ control.id_display }} ({{ control.title }})
          </h2>
          {% else %}
            Control was not found in the catalog.
          {% endif %}
        </div>
        <!-- Control Lookup-->
        <div style="float: right;">
            <form id="control-lookup" method="get" action="/controls/" onsubmit="show_control_by_id(); return false;">
              <input type="text" name="id" placeholder="Enter control id" title="Enter control id" value="{% if control %}{{ control.id_display|upper }}{% endif %}">
                  <button type="submit" class="btn btn-success">Look up</button>
                  <!-- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  <a href="/">families</a> -->
            </form>
        </div>
      </div>
    </div><!--/row-->

    <div id="tab-content" class="row">
      {% if control.title is not None %}
        <div role="" class="" id="control" style="">
          {% if control.title is not None %}
            <small style="color: #888;">Description</small>
            <p>
              {% if control.description|wordcount < 50 %}{{ control.description }}{% else %}{{ control.description|truncatewords:65 }}{% endif %}
              &nbsp;&nbsp;<a href="" onClick="show_control_description_modal();return false;">&gt;&gt;&gt;View full control</a>
            </p>
            <hr/>
            <small style="color: #888;">Part of</small>
            <p><b>{{ control.family_title }}</b> ({{ catalog.catalog_key_display }})</p>
            <small style="color: #888;">Conntinuous Monitoring</small>
            {% if control_matrix is not None %}
              <p>
                The required control monitoring for {{ control.id_display|upper }} is <u>{{ control_matrix.REVIEW_FREQUENCY|lower }} {% if control_matrix.AUTOMATED == 'YES' %} and automated{% endif %}</u>. {{ control_matrix_doc.discussion }}
              </p>
              <small style="color: #888;">Responsibility</small>
              <p>
                When hosted in the cloud, responsibility for {{ control.id_display|upper }} is likely {% if control_matrix.CLOUD_SHARED == 'YES' %} shared between you and{% else %}inherited from{% endif %} your cloud service provider. 
              </p>
            {% else %}
              <p>Monitoring information for {{ control.id_display|upper }} is not available.</p>
            {% endif %}
            <small style="color: #888;">Guidance</small>
            {% if control.guidance %}
              <p>
                {% if control.guidance|wordcount < 50 %}{{ control.guidance }}{% else %}{{ control.guidance|truncatewords:55 }}{% endif %}
                &nbsp;&nbsp;<a href="" onClick="show_control_description_modal();return false;">&gt;&gt;&gt;View full control</a>
              </p>
              <hr/>
            {% else %}
              <p>No guidance provided.</p>
            {% endif %}
          {% else %}
              <div id="control-message">
                  <p>The control {{ control.id }} was not found in the control catalog.</p>
              </div>
          {% endif %}
        </div>
        <div id="control-guidance"  class="hidden">
          <h4>Links</h4>
          {% if links %}
          <ul>
            {% for link in links %}
              <li><a href="{{ link.href }}" target="_blank">{{ link.catalog }} {{ link.text }}</a></li>
            {% endfor %}
          </ul>
          {% else %}
            No links provided.
          {% endif %}
        </div>
      {% else %}
      <div id="control-message">
        <p>Control is not found in the control catalog.</p>
      </div>
      {% endif %}

      {% if control.title is not None %}{% include "control-description-modal.html" %}{% endif %}

    </div>

  </div>
</div>
      {{ block.super }}
      {% endblock %}

      {% block scripts %}
      <script>
        // Submits control id for Control look up box
        function show_control_by_id() {
          var control_id = $('#control-lookup').find('input[name="id"]').val();
          var url = "/controls/catalogs/{{ catalog.catalog_key }}/control/"+control_id;
          window.location.href = url;
        }
      </script>
      {% endblock %}
